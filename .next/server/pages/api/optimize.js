"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/optimize";
exports.ids = ["pages/api/optimize"];
exports.modules = {

/***/ "(api-node)/./data_generator.js":
/*!***************************!*\
  !*** ./data_generator.js ***!
  \***************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _turf_turf__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @turf/turf */ \"@turf/turf\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_turf_turf__WEBPACK_IMPORTED_MODULE_0__]);\n_turf_turf__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// data_generator.js\n\n// Ethiopia bounding box coordinates\nconst ETHIOPIA_BBOX = [\n    32.997583,\n    3.397448,\n    47.982379,\n    14.894053\n];\nfunction generateSites(numSites) {\n    const [minLng, minLat, maxLng, maxLat] = ETHIOPIA_BBOX;\n    // Generate random coordinates within Ethiopia\n    const sites = [];\n    for(let i = 0; i < numSites; i++){\n        const lng = minLng + Math.random() * (maxLng - minLng);\n        const lat = minLat + Math.random() * (maxLat - minLat);\n        const cost = Math.floor(Math.random() * 35000) + 15000; // $15k-$50k\n        const pop = Math.floor(Math.random() * 1400) + 100; // 100-1500 people\n        const solar = parseFloat((Math.random() * 3 + 3.5).toFixed(2)); // 3.5-6.5 kWh/m2/day\n        const energy = parseFloat((solar * pop * 0.3).toFixed(2)); // Energy capacity\n        sites.push({\n            id: `Site_${i + 1}`,\n            cost,\n            pop,\n            energy,\n            lat,\n            lng\n        });\n    }\n    return sites;\n}\n// Generate Ethiopia dataset with 50 sites\nconst ethiopiaSites = generateSites(50);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ethiopiaSites);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2RhdGFfZ2VuZXJhdG9yLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsb0JBQW9CO0FBQytCO0FBRW5ELG9DQUFvQztBQUNwQyxNQUFNQyxnQkFBZ0I7SUFBQztJQUFXO0lBQVU7SUFBVztDQUFVO0FBRWpFLFNBQVNDLGNBQWNDLFFBQVE7SUFDN0IsTUFBTSxDQUFDQyxRQUFRQyxRQUFRQyxRQUFRQyxPQUFPLEdBQUdOO0lBRXpDLDhDQUE4QztJQUM5QyxNQUFNTyxRQUFRLEVBQUU7SUFDaEIsSUFBSyxJQUFJQyxJQUFJLEdBQUdBLElBQUlOLFVBQVVNLElBQUs7UUFDakMsTUFBTUMsTUFBTU4sU0FBU08sS0FBS0MsTUFBTSxLQUFNTixDQUFBQSxTQUFTRixNQUFLO1FBQ3BELE1BQU1TLE1BQU1SLFNBQVNNLEtBQUtDLE1BQU0sS0FBTUwsQ0FBQUEsU0FBU0YsTUFBSztRQUNwRCxNQUFNUyxPQUFPSCxLQUFLSSxLQUFLLENBQUNKLEtBQUtDLE1BQU0sS0FBSyxTQUFTLE9BQU8sWUFBWTtRQUNwRSxNQUFNSSxNQUFNTCxLQUFLSSxLQUFLLENBQUNKLEtBQUtDLE1BQU0sS0FBSyxRQUFRLEtBQUssa0JBQWtCO1FBQ3RFLE1BQU1LLFFBQVFDLFdBQVcsQ0FBQ1AsS0FBS0MsTUFBTSxLQUFLLElBQUksR0FBRSxFQUFHTyxPQUFPLENBQUMsS0FBSyxxQkFBcUI7UUFDckYsTUFBTUMsU0FBU0YsV0FBVyxDQUFDRCxRQUFRRCxNQUFNLEdBQUUsRUFBR0csT0FBTyxDQUFDLEtBQUssa0JBQWtCO1FBRTdFWCxNQUFNYSxJQUFJLENBQUM7WUFDVEMsSUFBSSxDQUFDLEtBQUssRUFBRWIsSUFBRSxHQUFHO1lBQ2pCSztZQUNBRTtZQUNBSTtZQUNBUDtZQUNBSDtRQUNGO0lBQ0Y7SUFDQSxPQUFPRjtBQUNUO0FBRUEsMENBQTBDO0FBQzFDLE1BQU1lLGdCQUFnQnJCLGNBQWM7QUFDcEMsaUVBQWVxQixhQUFhQSxFQUFDIiwic291cmNlcyI6WyIvaG9tZS9haW1zYS9RRW5lcmd5L2NsYXNzaWNhbC9RRW5lcmd5L2RhdGFfZ2VuZXJhdG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGRhdGFfZ2VuZXJhdG9yLmpzXG5pbXBvcnQgeyBib29sZWFuUG9pbnRJblBvbHlnb24gfSBmcm9tICdAdHVyZi90dXJmJztcblxuLy8gRXRoaW9waWEgYm91bmRpbmcgYm94IGNvb3JkaW5hdGVzXG5jb25zdCBFVEhJT1BJQV9CQk9YID0gWzMyLjk5NzU4MywgMy4zOTc0NDgsIDQ3Ljk4MjM3OSwgMTQuODk0MDUzXTtcblxuZnVuY3Rpb24gZ2VuZXJhdGVTaXRlcyhudW1TaXRlcykge1xuICBjb25zdCBbbWluTG5nLCBtaW5MYXQsIG1heExuZywgbWF4TGF0XSA9IEVUSElPUElBX0JCT1g7XG4gIFxuICAvLyBHZW5lcmF0ZSByYW5kb20gY29vcmRpbmF0ZXMgd2l0aGluIEV0aGlvcGlhXG4gIGNvbnN0IHNpdGVzID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtU2l0ZXM7IGkrKykge1xuICAgIGNvbnN0IGxuZyA9IG1pbkxuZyArIE1hdGgucmFuZG9tKCkgKiAobWF4TG5nIC0gbWluTG5nKTtcbiAgICBjb25zdCBsYXQgPSBtaW5MYXQgKyBNYXRoLnJhbmRvbSgpICogKG1heExhdCAtIG1pbkxhdCk7XG4gICAgY29uc3QgY29zdCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDM1MDAwKSArIDE1MDAwOyAvLyAkMTVrLSQ1MGtcbiAgICBjb25zdCBwb3AgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxNDAwKSArIDEwMDsgLy8gMTAwLTE1MDAgcGVvcGxlXG4gICAgY29uc3Qgc29sYXIgPSBwYXJzZUZsb2F0KChNYXRoLnJhbmRvbSgpICogMyArIDMuNSkudG9GaXhlZCgyKSk7IC8vIDMuNS02LjUga1doL20yL2RheVxuICAgIGNvbnN0IGVuZXJneSA9IHBhcnNlRmxvYXQoKHNvbGFyICogcG9wICogMC4zKS50b0ZpeGVkKDIpKTsgLy8gRW5lcmd5IGNhcGFjaXR5XG4gICAgXG4gICAgc2l0ZXMucHVzaCh7XG4gICAgICBpZDogYFNpdGVfJHtpKzF9YCxcbiAgICAgIGNvc3QsXG4gICAgICBwb3AsXG4gICAgICBlbmVyZ3ksXG4gICAgICBsYXQsXG4gICAgICBsbmdcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gc2l0ZXM7XG59XG5cbi8vIEdlbmVyYXRlIEV0aGlvcGlhIGRhdGFzZXQgd2l0aCA1MCBzaXRlc1xuY29uc3QgZXRoaW9waWFTaXRlcyA9IGdlbmVyYXRlU2l0ZXMoNTApO1xuZXhwb3J0IGRlZmF1bHQgZXRoaW9waWFTaXRlczsiXSwibmFtZXMiOlsiYm9vbGVhblBvaW50SW5Qb2x5Z29uIiwiRVRISU9QSUFfQkJPWCIsImdlbmVyYXRlU2l0ZXMiLCJudW1TaXRlcyIsIm1pbkxuZyIsIm1pbkxhdCIsIm1heExuZyIsIm1heExhdCIsInNpdGVzIiwiaSIsImxuZyIsIk1hdGgiLCJyYW5kb20iLCJsYXQiLCJjb3N0IiwiZmxvb3IiLCJwb3AiLCJzb2xhciIsInBhcnNlRmxvYXQiLCJ0b0ZpeGVkIiwiZW5lcmd5IiwicHVzaCIsImlkIiwiZXRoaW9waWFTaXRlcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./data_generator.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Foptimize&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Foptimize.js&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Foptimize&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Foptimize.js&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_optimize_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/optimize.js */ \"(api-node)/./pages/api/optimize.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_optimize_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_optimize_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_optimize_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_optimize_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/optimize\",\n        pathname: \"/api/optimize\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_optimize_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGb3B0aW1pemUmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRm9wdGltaXplLmpzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNFO0FBQzFEO0FBQ29EO0FBQ3BEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxtREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsbURBQVE7QUFDcEM7QUFDTyx3QkFBd0IseUdBQW1CO0FBQ2xEO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkvb3B0aW1pemUuanNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgJ2RlZmF1bHQnKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsICdjb25maWcnKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL29wdGltaXplXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvb3B0aW1pemVcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiAnJyxcbiAgICAgICAgZmlsZW5hbWU6ICcnXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Foptimize&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Foptimize.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/optimize.js":
/*!*******************************!*\
  !*** ./pages/api/optimize.js ***!
  \*******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _turf_turf__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @turf/turf */ \"@turf/turf\");\n/* harmony import */ var _data_generator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../data_generator */ \"(api-node)/./data_generator.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_turf_turf__WEBPACK_IMPORTED_MODULE_0__, _data_generator__WEBPACK_IMPORTED_MODULE_1__]);\n([_turf_turf__WEBPACK_IMPORTED_MODULE_0__, _data_generator__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n// optimize.js\n\n\n// Simulated annealing for QUBO\nasync function simulatedAnnealingQUBO(Q, n, candidates, budget, maxIter = 10000, T0 = 20, alpha = 0.999) {\n    let x = Array(n).fill(0);\n    let bestX = x.slice(), bestE = Infinity;\n    let T = T0;\n    const costPenalty = 10000 / budget;\n    function energy(x) {\n        let e = 0, cost = 0;\n        for(let i = 0; i < n; i++){\n            if (x[i]) cost += candidates[i].cost;\n            for(let j = 0; j < n; j++)e += Q[i][j] * x[i] * x[j];\n        }\n        if (cost > budget) e += costPenalty * (cost - budget) ** 2;\n        return e;\n    }\n    for(let iter = 0; iter < maxIter; iter++){\n        let i = Math.floor(Math.random() * n);\n        let x2 = x.slice();\n        x2[i] = 1 - x2[i];\n        let e1 = energy(x), e2 = energy(x2);\n        if (e2 < e1 || Math.random() < Math.exp((e1 - e2) / T)) {\n            x = x2;\n            if (e2 < bestE) {\n                bestE = e2;\n                bestX = x.slice();\n            }\n        }\n        T *= alpha;\n        if (T < 1e-6) break;\n    }\n    return bestX;\n}\n// NAR greedy optimization\nfunction narGreedyBudget(Q, candidates, budget) {\n    const idxs = candidates.map((c, i)=>i).sort((a, b)=>candidates[b].energy / candidates[b].cost - candidates[a].energy / candidates[a].cost);\n    let total = 0;\n    let selected = [];\n    for (let i of idxs){\n        if (total + candidates[i].cost <= budget) {\n            selected.push(i);\n            total += candidates[i].cost;\n        }\n    }\n    return candidates.map((_, i)=>selected.includes(i) ? 1 : 0);\n}\n// Gurobi QUBO solver\nasync function gurobiQUBOBudget(Q, candidates, budget) {\n    try {\n        const { spawnSync } = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! child_process */ \"child_process\", 23));\n        const fs = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs */ \"fs\", 23));\n        const path = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! path */ \"path\", 23));\n        const tmpDir = '/tmp';\n        const quboPath = path.join(tmpDir, `qubo_gurobi_${Date.now()}.json`);\n        const costsPath = path.join(tmpDir, `costs_gurobi_${Date.now()}.json`);\n        fs.writeFileSync(quboPath, JSON.stringify({\n            Q\n        }));\n        fs.writeFileSync(costsPath, JSON.stringify(candidates.map((c)=>c.cost)));\n        const pyPath = path.join(process.cwd(), 'gurobi_optimize.py');\n        const result = spawnSync('python3', [\n            pyPath,\n            '--qubo_file',\n            quboPath,\n            '--budget',\n            String(budget),\n            '--costs_file',\n            costsPath\n        ], {\n            encoding: 'utf-8'\n        });\n        fs.unlinkSync(quboPath);\n        fs.unlinkSync(costsPath);\n        if (result.status !== 0) throw new Error(result.stderr || 'Gurobi failed');\n        const out = result.stdout.trim().split('\\n').pop();\n        const parsed = JSON.parse(out);\n        const x = candidates.map((_, i)=>parsed.selected_indices.includes(i) ? 1 : 0);\n        return x;\n    } catch (e) {\n        throw new Error('Gurobi optimization failed: ' + e.message);\n    }\n}\nasync function handler(req, res) {\n    const { polygon, budget, popCenter, quboOnly, algo } = req.body;\n    if (!polygon || polygon.length !== 4 || !budget || budget <= 0 || !popCenter) {\n        return res.status(400).json({\n            error: 'Invalid input'\n        });\n    }\n    // Close the polygon\n    const coords = [\n        ...polygon.map((p)=>[\n                p.lng,\n                p.lat\n            ]),\n        [\n            polygon[0].lng,\n            polygon[0].lat\n        ]\n    ];\n    const turfPoly = (0,_turf_turf__WEBPACK_IMPORTED_MODULE_0__.polygon)([\n        coords\n    ]);\n    // Filter sites within polygon\n    const candidates = ethiopiaSites.filter((site)=>(0,_turf_turf__WEBPACK_IMPORTED_MODULE_0__.booleanPointInPolygon)([\n            site.lng,\n            site.lat\n        ], turfPoly)).map((site)=>({\n            ...site,\n            dist: (0,_turf_turf__WEBPACK_IMPORTED_MODULE_0__.distance)([\n                site.lng,\n                site.lat\n            ], [\n                popCenter.lng,\n                popCenter.lat\n            ], {\n                units: 'kilometers'\n            })\n        }));\n    if (candidates.length === 0) {\n        return res.status(200).json({\n            grids: []\n        });\n    }\n    // QUBO parameters\n    const alpha = 1; // population coverage weight\n    const theta = 1000; // budget penalty\n    const mu = 1000; // grid count penalty\n    const lambda = 1000; // minimum coverage penalty\n    const K = req.body.K ?? Math.floor(budget / 15000); // default max sites\n    const M = req.body.M ?? 0; // default min coverage\n    // Build QUBO matrix\n    const n = candidates.length;\n    const Q = Array.from({\n        length: n\n    }, (_, i)=>Array(n).fill(0));\n    const C = candidates.map((c)=>c.cost);\n    const P = candidates.map((c)=>c.pop);\n    for(let i = 0; i < n; i++){\n        Q[i][i] += C[i] - alpha * P[i];\n        Q[i][i] += theta * (C[i] ** 2 - 2 * budget * C[i]);\n        Q[i][i] += mu * (1 - 2 * K);\n        Q[i][i] += lambda * (P[i] ** 2 - 2 * M * P[i]);\n        for(let j = 0; j < n; j++){\n            if (i === j) continue;\n            Q[i][j] += 2 * theta * C[i] * C[j];\n            Q[i][j] += 2 * mu;\n            Q[i][j] += 2 * lambda * P[i] * P[j];\n        }\n    }\n    Q[0][0] += theta * budget ** 2 + mu * K ** 2 + lambda * M ** 2;\n    // Return QUBO for quantum if requested\n    if (quboOnly) {\n        const maxCandidates = 1000;\n        if (candidates.length > maxCandidates) {\n            const step = Math.ceil(candidates.length / maxCandidates);\n            const reducedCandidates = candidates.filter((_, i)=>i % step === 0).slice(0, maxCandidates);\n            const reducedQ = reducedCandidates.map((_, i)=>reducedCandidates.map((_, j)=>Q[i * step]?.[j * step] ?? 0));\n            return res.status(200).json({\n                Q: reducedQ,\n                candidates: reducedCandidates,\n                budget\n            });\n        }\n        return res.status(200).json({\n            Q,\n            candidates,\n            budget\n        });\n    }\n    // Run optimization\n    let x;\n    try {\n        if (algo === 'nar') {\n            x = narGreedyBudget(Q, candidates, budget);\n        } else if (algo === 'gurobi') {\n            x = await gurobiQUBOBudget(Q, candidates, budget);\n        } else {\n            x = await simulatedAnnealingQUBO(Q, candidates.length, candidates, budget);\n        }\n    } catch (e) {\n        console.error('Optimization error:', e);\n        return res.status(500).json({\n            error: e.message\n        });\n    }\n    const grids = candidates.filter((c, i)=>x[i]).map((c)=>({\n            lat: c.lat,\n            lng: c.lng,\n            cost: c.cost,\n            energy: c.energy,\n            dist: c.dist,\n            pop: c.pop\n        }));\n    res.status(200).json({\n        grids\n    });\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQUksQ0FBQztRQUFFWTtJQUFNO0FBQy9CIiwic291cmNlcyI6WyIvaG9tZS9haW1zYS9RRW5lcmd5L2NsYXNzaWNhbC9RRW5lcmd5L3BhZ2VzL2FwaS9vcHRpbWl6ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBvcHRpbWl6ZS5qc1xuaW1wb3J0IHsgcG9seWdvbiBhcyB0dXJmUG9seWdvbiwgYm9vbGVhblBvaW50SW5Qb2x5Z29uLCBkaXN0YW5jZSBhcyB0dXJmRGlzdGFuY2UgfSBmcm9tICdAdHVyZi90dXJmJztcbmltcG9ydCBldGhpb3BpYURhdGFzZXQgZnJvbSAnLi4vLi4vZGF0YV9nZW5lcmF0b3InO1xuXG4vLyBTaW11bGF0ZWQgYW5uZWFsaW5nIGZvciBRVUJPXG5hc3luYyBmdW5jdGlvbiBzaW11bGF0ZWRBbm5lYWxpbmdRVUJPKFEsIG4sIGNhbmRpZGF0ZXMsIGJ1ZGdldCwgbWF4SXRlciA9IDEwMDAwLCBUMCA9IDIwLCBhbHBoYSA9IDAuOTk5KSB7XG4gIGxldCB4ID0gQXJyYXkobikuZmlsbCgwKTtcbiAgbGV0IGJlc3RYID0geC5zbGljZSgpLCBiZXN0RSA9IEluZmluaXR5O1xuICBsZXQgVCA9IFQwO1xuICBjb25zdCBjb3N0UGVuYWx0eSA9IDEwMDAwIC8gYnVkZ2V0O1xuICBcbiAgZnVuY3Rpb24gZW5lcmd5KHgpIHtcbiAgICBsZXQgZSA9IDAsIGNvc3QgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7XG4gICAgICBpZiAoeFtpXSkgY29zdCArPSBjYW5kaWRhdGVzW2ldLmNvc3Q7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG47IGorKykgZSArPSBRW2ldW2pdICogeFtpXSAqIHhbal07XG4gICAgfVxuICAgIGlmIChjb3N0ID4gYnVkZ2V0KSBlICs9IGNvc3RQZW5hbHR5ICogKGNvc3QgLSBidWRnZXQpICoqIDI7XG4gICAgcmV0dXJuIGU7XG4gIH1cblxuICBmb3IgKGxldCBpdGVyID0gMDsgaXRlciA8IG1heEl0ZXI7IGl0ZXIrKykge1xuICAgIGxldCBpID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbik7XG4gICAgbGV0IHgyID0geC5zbGljZSgpOyB4MltpXSA9IDEgLSB4MltpXTtcbiAgICBsZXQgZTEgPSBlbmVyZ3koeCksIGUyID0gZW5lcmd5KHgyKTtcbiAgICBpZiAoZTIgPCBlMSB8fCBNYXRoLnJhbmRvbSgpIDwgTWF0aC5leHAoKGUxIC0gZTIpIC8gVCkpIHtcbiAgICAgIHggPSB4MjtcbiAgICAgIGlmIChlMiA8IGJlc3RFKSB7IGJlc3RFID0gZTI7IGJlc3RYID0geC5zbGljZSgpOyB9XG4gICAgfVxuICAgIFQgKj0gYWxwaGE7XG4gICAgaWYgKFQgPCAxZS02KSBicmVhaztcbiAgfVxuICByZXR1cm4gYmVzdFg7XG59XG5cbi8vIE5BUiBncmVlZHkgb3B0aW1pemF0aW9uXG5mdW5jdGlvbiBuYXJHcmVlZHlCdWRnZXQoUSwgY2FuZGlkYXRlcywgYnVkZ2V0KSB7XG4gIGNvbnN0IGlkeHMgPSBjYW5kaWRhdGVzLm1hcCgoYywgaSkgPT4gaSlcbiAgICAuc29ydCgoYSwgYikgPT4gKGNhbmRpZGF0ZXNbYl0uZW5lcmd5IC8gY2FuZGlkYXRlc1tiXS5jb3N0KSAtIChjYW5kaWRhdGVzW2FdLmVuZXJneSAvIGNhbmRpZGF0ZXNbYV0uY29zdCkpO1xuICBsZXQgdG90YWwgPSAwO1xuICBsZXQgc2VsZWN0ZWQgPSBbXTtcbiAgZm9yIChsZXQgaSBvZiBpZHhzKSB7XG4gICAgaWYgKHRvdGFsICsgY2FuZGlkYXRlc1tpXS5jb3N0IDw9IGJ1ZGdldCkge1xuICAgICAgc2VsZWN0ZWQucHVzaChpKTtcbiAgICAgIHRvdGFsICs9IGNhbmRpZGF0ZXNbaV0uY29zdDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNhbmRpZGF0ZXMubWFwKChfLCBpKSA9PiBzZWxlY3RlZC5pbmNsdWRlcyhpKSA/IDEgOiAwKTtcbn1cblxuLy8gR3Vyb2JpIFFVQk8gc29sdmVyXG5hc3luYyBmdW5jdGlvbiBndXJvYmlRVUJPQnVkZ2V0KFEsIGNhbmRpZGF0ZXMsIGJ1ZGdldCkge1xuICB0cnkge1xuICAgIGNvbnN0IHsgc3Bhd25TeW5jIH0gPSBhd2FpdCBpbXBvcnQoJ2NoaWxkX3Byb2Nlc3MnKTtcbiAgICBjb25zdCBmcyA9IGF3YWl0IGltcG9ydCgnZnMnKTtcbiAgICBjb25zdCBwYXRoID0gYXdhaXQgaW1wb3J0KCdwYXRoJyk7XG4gICAgY29uc3QgdG1wRGlyID0gJy90bXAnO1xuICAgIGNvbnN0IHF1Ym9QYXRoID0gcGF0aC5qb2luKHRtcERpciwgYHF1Ym9fZ3Vyb2JpXyR7RGF0ZS5ub3coKX0uanNvbmApO1xuICAgIGNvbnN0IGNvc3RzUGF0aCA9IHBhdGguam9pbih0bXBEaXIsIGBjb3N0c19ndXJvYmlfJHtEYXRlLm5vdygpfS5qc29uYCk7XG4gICAgZnMud3JpdGVGaWxlU3luYyhxdWJvUGF0aCwgSlNPTi5zdHJpbmdpZnkoeyBRIH0pKTtcbiAgICBmcy53cml0ZUZpbGVTeW5jKGNvc3RzUGF0aCwgSlNPTi5zdHJpbmdpZnkoY2FuZGlkYXRlcy5tYXAoYyA9PiBjLmNvc3QpKSk7XG4gICAgY29uc3QgcHlQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdndXJvYmlfb3B0aW1pemUucHknKTtcbiAgICBjb25zdCByZXN1bHQgPSBzcGF3blN5bmMoJ3B5dGhvbjMnLCBbcHlQYXRoLCAnLS1xdWJvX2ZpbGUnLCBxdWJvUGF0aCwgJy0tYnVkZ2V0JywgU3RyaW5nKGJ1ZGdldCksICctLWNvc3RzX2ZpbGUnLCBjb3N0c1BhdGhdLCB7IGVuY29kaW5nOiAndXRmLTgnIH0pO1xuICAgIGZzLnVubGlua1N5bmMocXVib1BhdGgpO1xuICAgIGZzLnVubGlua1N5bmMoY29zdHNQYXRoKTtcbiAgICBpZiAocmVzdWx0LnN0YXR1cyAhPT0gMCkgdGhyb3cgbmV3IEVycm9yKHJlc3VsdC5zdGRlcnIgfHwgJ0d1cm9iaSBmYWlsZWQnKTtcbiAgICBjb25zdCBvdXQgPSByZXN1bHQuc3Rkb3V0LnRyaW0oKS5zcGxpdCgnXFxuJykucG9wKCk7XG4gICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShvdXQpO1xuICAgIGNvbnN0IHggPSBjYW5kaWRhdGVzLm1hcCgoXywgaSkgPT4gcGFyc2VkLnNlbGVjdGVkX2luZGljZXMuaW5jbHVkZXMoaSkgPyAxIDogMCk7XG4gICAgcmV0dXJuIHg7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0d1cm9iaSBvcHRpbWl6YXRpb24gZmFpbGVkOiAnICsgZS5tZXNzYWdlKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHsgcG9seWdvbiwgYnVkZ2V0LCBwb3BDZW50ZXIsIHF1Ym9Pbmx5LCBhbGdvIH0gPSByZXEuYm9keTtcblxuICBpZiAoIXBvbHlnb24gfHwgcG9seWdvbi5sZW5ndGggIT09IDQgfHwgIWJ1ZGdldCB8fCBidWRnZXQgPD0gMCB8fCAhcG9wQ2VudGVyKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdJbnZhbGlkIGlucHV0JyB9KTtcbiAgfVxuXG4gIC8vIENsb3NlIHRoZSBwb2x5Z29uXG4gIGNvbnN0IGNvb3JkcyA9IFsuLi5wb2x5Z29uLm1hcChwID0+IFtwLmxuZywgcC5sYXRdKSwgW3BvbHlnb25bMF0ubG5nLCBwb2x5Z29uWzBdLmxhdF1dO1xuICBjb25zdCB0dXJmUG9seSA9IHR1cmZQb2x5Z29uKFtjb29yZHNdKTtcblxuICAvLyBGaWx0ZXIgc2l0ZXMgd2l0aGluIHBvbHlnb25cbiAgY29uc3QgY2FuZGlkYXRlcyA9IGV0aGlvcGlhU2l0ZXMuZmlsdGVyKHNpdGUgPT4gXG4gICAgYm9vbGVhblBvaW50SW5Qb2x5Z29uKFtzaXRlLmxuZywgc2l0ZS5sYXRdLCB0dXJmUG9seSlcbiAgKS5tYXAoc2l0ZSA9PiAoe1xuICAgIC4uLnNpdGUsXG4gICAgZGlzdDogdHVyZkRpc3RhbmNlKFtzaXRlLmxuZywgc2l0ZS5sYXRdLCBbcG9wQ2VudGVyLmxuZywgcG9wQ2VudGVyLmxhdF0sIHsgdW5pdHM6ICdraWxvbWV0ZXJzJyB9KVxuICB9KSk7XG5cbiAgaWYgKGNhbmRpZGF0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgZ3JpZHM6IFtdIH0pO1xuICB9XG5cbiAgLy8gUVVCTyBwYXJhbWV0ZXJzXG4gIGNvbnN0IGFscGhhID0gMTsgICAgICAvLyBwb3B1bGF0aW9uIGNvdmVyYWdlIHdlaWdodFxuICBjb25zdCB0aGV0YSA9IDEwMDA7ICAgLy8gYnVkZ2V0IHBlbmFsdHlcbiAgY29uc3QgbXUgPSAxMDAwOyAgICAgIC8vIGdyaWQgY291bnQgcGVuYWx0eVxuICBjb25zdCBsYW1iZGEgPSAxMDAwOyAgLy8gbWluaW11bSBjb3ZlcmFnZSBwZW5hbHR5XG4gIGNvbnN0IEsgPSByZXEuYm9keS5LID8/IE1hdGguZmxvb3IoYnVkZ2V0IC8gMTUwMDApOyAvLyBkZWZhdWx0IG1heCBzaXRlc1xuICBjb25zdCBNID0gcmVxLmJvZHkuTSA/PyAwOyAvLyBkZWZhdWx0IG1pbiBjb3ZlcmFnZVxuXG4gIC8vIEJ1aWxkIFFVQk8gbWF0cml4XG4gIGNvbnN0IG4gPSBjYW5kaWRhdGVzLmxlbmd0aDtcbiAgY29uc3QgUSA9IEFycmF5LmZyb20oeyBsZW5ndGg6IG4gfSwgKF8sIGkpID0+IEFycmF5KG4pLmZpbGwoMCkpO1xuICBjb25zdCBDID0gY2FuZGlkYXRlcy5tYXAoYyA9PiBjLmNvc3QpO1xuICBjb25zdCBQID0gY2FuZGlkYXRlcy5tYXAoYyA9PiBjLnBvcCk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICBRW2ldW2ldICs9IENbaV0gLSBhbHBoYSAqIFBbaV07XG4gICAgUVtpXVtpXSArPSB0aGV0YSAqIChDW2ldICoqIDIgLSAyICogYnVkZ2V0ICogQ1tpXSk7XG4gICAgUVtpXVtpXSArPSBtdSAqICgxIC0gMiAqIEspO1xuICAgIFFbaV1baV0gKz0gbGFtYmRhICogKFBbaV0gKiogMiAtIDIgKiBNICogUFtpXSk7XG4gICAgXG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBuOyBqKyspIHtcbiAgICAgIGlmIChpID09PSBqKSBjb250aW51ZTtcbiAgICAgIFFbaV1bal0gKz0gMiAqIHRoZXRhICogQ1tpXSAqIENbal07XG4gICAgICBRW2ldW2pdICs9IDIgKiBtdTtcbiAgICAgIFFbaV1bal0gKz0gMiAqIGxhbWJkYSAqIFBbaV0gKiBQW2pdO1xuICAgIH1cbiAgfVxuICBRWzBdWzBdICs9IHRoZXRhICogYnVkZ2V0ICoqIDIgKyBtdSAqIEsgKiogMiArIGxhbWJkYSAqIE0gKiogMjtcblxuICAvLyBSZXR1cm4gUVVCTyBmb3IgcXVhbnR1bSBpZiByZXF1ZXN0ZWRcbiAgaWYgKHF1Ym9Pbmx5KSB7XG4gICAgY29uc3QgbWF4Q2FuZGlkYXRlcyA9IDEwMDA7XG4gICAgaWYgKGNhbmRpZGF0ZXMubGVuZ3RoID4gbWF4Q2FuZGlkYXRlcykge1xuICAgICAgY29uc3Qgc3RlcCA9IE1hdGguY2VpbChjYW5kaWRhdGVzLmxlbmd0aCAvIG1heENhbmRpZGF0ZXMpO1xuICAgICAgY29uc3QgcmVkdWNlZENhbmRpZGF0ZXMgPSBjYW5kaWRhdGVzLmZpbHRlcigoXywgaSkgPT4gaSAlIHN0ZXAgPT09IDApLnNsaWNlKDAsIG1heENhbmRpZGF0ZXMpO1xuICAgICAgY29uc3QgcmVkdWNlZFEgPSByZWR1Y2VkQ2FuZGlkYXRlcy5tYXAoKF8sIGkpID0+IFxuICAgICAgICByZWR1Y2VkQ2FuZGlkYXRlcy5tYXAoKF8sIGopID0+IFFbaSAqIHN0ZXBdPy5baiAqIHN0ZXBdID8/IDApKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IFE6IHJlZHVjZWRRLCBjYW5kaWRhdGVzOiByZWR1Y2VkQ2FuZGlkYXRlcywgYnVkZ2V0IH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBRLCBjYW5kaWRhdGVzLCBidWRnZXQgfSk7XG4gIH1cblxuICAvLyBSdW4gb3B0aW1pemF0aW9uXG4gIGxldCB4O1xuICB0cnkge1xuICAgIGlmIChhbGdvID09PSAnbmFyJykge1xuICAgICAgeCA9IG5hckdyZWVkeUJ1ZGdldChRLCBjYW5kaWRhdGVzLCBidWRnZXQpO1xuICAgIH0gZWxzZSBpZiAoYWxnbyA9PT0gJ2d1cm9iaScpIHtcbiAgICAgIHggPSBhd2FpdCBndXJvYmlRVUJPQnVkZ2V0KFEsIGNhbmRpZGF0ZXMsIGJ1ZGdldCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHggPSBhd2FpdCBzaW11bGF0ZWRBbm5lYWxpbmdRVUJPKFEsIGNhbmRpZGF0ZXMubGVuZ3RoLCBjYW5kaWRhdGVzLCBidWRnZXQpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ09wdGltaXphdGlvbiBlcnJvcjonLCBlKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogZS5tZXNzYWdlIH0pO1xuICB9XG5cbiAgY29uc3QgZ3JpZHMgPSBjYW5kaWRhdGVzLmZpbHRlcigoYywgaSkgPT4geFtpXSkubWFwKGMgPT4gKHtcbiAgICBsYXQ6IGMubGF0LFxuICAgIGxuZzogYy5sbmcsXG4gICAgY29zdDogYy5jb3N0LFxuICAgIGVuZXJneTogYy5lbmVyZ3ksXG4gICAgZGlzdDogYy5kaXN0LFxuICAgIHBvcDogYy5wb3BcbiAgfSkpO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgZ3JpZHMgfSk7XG59Il0sIm5hbWVzIjpbInBvbHlnb24iLCJ0dXJmUG9seWdvbiIsImJvb2xlYW5Qb2ludEluUG9seWdvbiIsImRpc3RhbmNlIiwidHVyZkRpc3RhbmNlIiwiZXRoaW9waWFEYXRhc2V0Iiwic2ltdWxhdGVkQW5uZWFsaW5nUVVCTyIsIlEiLCJuIiwiY2FuZGlkYXRlcyIsImJ1ZGdldCIsIm1heEl0ZXIiLCJUMCIsImFscGhhIiwieCIsIkFycmF5IiwiZmlsbCIsImJlc3RYIiwic2xpY2UiLCJiZXN0RSIsIkluZmluaXR5IiwiVCIsImNvc3RQZW5hbHR5IiwiZW5lcmd5IiwiZSIsImNvc3QiLCJpIiwiaiIsIml0ZXIiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJ4MiIsImUxIiwiZTIiLCJleHAiLCJuYXJHcmVlZHlCdWRnZXQiLCJpZHhzIiwibWFwIiwiYyIsInNvcnQiLCJhIiwiYiIsInRvdGFsIiwic2VsZWN0ZWQiLCJwdXNoIiwiXyIsImluY2x1ZGVzIiwiZ3Vyb2JpUVVCT0J1ZGdldCIsInNwYXduU3luYyIsImZzIiwicGF0aCIsInRtcERpciIsInF1Ym9QYXRoIiwiam9pbiIsIkRhdGUiLCJub3ciLCJjb3N0c1BhdGgiLCJ3cml0ZUZpbGVTeW5jIiwiSlNPTiIsInN0cmluZ2lmeSIsInB5UGF0aCIsInByb2Nlc3MiLCJjd2QiLCJyZXN1bHQiLCJTdHJpbmciLCJlbmNvZGluZyIsInVubGlua1N5bmMiLCJzdGF0dXMiLCJFcnJvciIsInN0ZGVyciIsIm91dCIsInN0ZG91dCIsInRyaW0iLCJzcGxpdCIsInBvcCIsInBhcnNlZCIsInBhcnNlIiwic2VsZWN0ZWRfaW5kaWNlcyIsIm1lc3NhZ2UiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwicG9wQ2VudGVyIiwicXVib09ubHkiLCJhbGdvIiwiYm9keSIsImxlbmd0aCIsImpzb24iLCJlcnJvciIsImNvb3JkcyIsInAiLCJsbmciLCJsYXQiLCJ0dXJmUG9seSIsImV0aGlvcGlhU2l0ZXMiLCJmaWx0ZXIiLCJzaXRlIiwiZGlzdCIsInVuaXRzIiwiZ3JpZHMiLCJ0aGV0YSIsIm11IiwibGFtYmRhIiwiSyIsIk0iLCJmcm9tIiwiQyIsIlAiLCJtYXhDYW5kaWRhdGVzIiwic3RlcCIsImNlaWwiLCJyZWR1Y2VkQ2FuZGlkYXRlcyIsInJlZHVjZWRRIiwiY29uc29sZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/optimize.js\n");

/***/ }),

/***/ "@turf/turf":
/*!*****************************!*\
  !*** external "@turf/turf" ***!
  \*****************************/
/***/ ((module) => {

module.exports = import("@turf/turf");;

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Foptimize&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Foptimize.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();